<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Skype API connection test page</title>
  <meta name="description" content="Skype API connection test page">
  <meta name="author" content="Andrew Weighill">


</head>

<body>
	<button type="button" id="connect_strava">Connect to Strava</button>


<script>
	function getAccessToken(code, scope) {
		console.log(code);
		console.log(scope);
		var xhr = new XMLHttpRequest();
		xhr.open("POST", "https://www.strava.com/oauth/token?", true);
		var data = {
			"client_id":"37683",
			"client_secret":"68670894f9fb4523eca81114bf9b2e3b303da3c0",
			"code":"\""+code+"\"",
			"grant_type":"authorization_code"
		}
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.addEventListener('load', function(event) {
			console.log(xhr.responseText);
		});
		xhr.send(JSON.stringify(data));
		
	}
	
	function runWhenPageLoaded() {
		//code to be run when the page is loaded
		var urlString = window.location;
		var urlParameters = (new URL(urlString)).searchParams;
		var code = urlParameters.get('code');
		var scope = urlParameters.get('scope');
		var err = urlParameters.get('error');
		console.log(code);
		console.log(scope);
		console.log(err);
		if (code != null && scope != null) {
			getAccessToken(code, scope);
		}
	}
	window.onload = runWhenPageLoaded;
	
	var connectStrava = document.getElementById("connect_strava");
	connectStrava.addEventListener('click', function(event) {
		console.log("redirect");
		window.location.href = "https://www.strava.com/oauth/authorize?client_id=37683&response_type=code&redirect_uri=https://cycomp.github.io&approval_prompt=force&scope=read";
	});
	
	
</script>
</body>
</html>
